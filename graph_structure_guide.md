# Руководство по работе с графовой структурой знаний

## Введение

Графовая структура знаний в Банке Памяти представляет собой мощный инструмент для моделирования и запроса сложных взаимосвязей между элементами проекта. Этот документ описывает, как эффективно использовать эту функциональность в контексте протокола RIPER и Банка Памяти.

## Структура графа знаний

Граф знаний состоит из двух основных элементов:

1. **Узлы (Nodes)** - представляют сущности в проекте
   - Каждый узел имеет уникальный ID
   - Тип узла (например, Function, File, Concept, Component)
   - Человекочитаемая метка
   - Опциональные структурированные данные

2. **Ребра (Edges)** - представляют отношения между узлами
   - Направленные связи от исходного узла к целевому
   - Тип отношения (например, CALLS, IMPLEMENTS, DEPENDS_ON)

## Типичные сценарии использования графа

### 1. Моделирование архитектуры
   - Создание узлов для компонентов системы
   - Определение зависимостей между компонентами через ребра
   - Запрос для визуализации архитектуры системы

### 2. Отслеживание функциональных зависимостей
   - Моделирование функций как узлов
   - Создание ребер типа CALLS между вызывающими и вызываемыми функциями
   - Запрос для анализа потенциального воздействия изменений

### 3. Концептуальное моделирование
   - Создание узлов для ключевых концепций проекта
   - Связывание концепций с их реализациями в коде
   - Запрос для понимания, как абстрактные концепции воплощаются в коде

### 4. Отслеживание требований
   - Моделирование требований как узлов
   - Связывание требований с компонентами, которые их реализуют
   - Запрос для проверки покрытия требований

## Инструменты для работы с графом

### Создание и обновление

1. **mcp_memory_bank_add_node**
   ```
   Параметры:
   - project_name: имя проекта
   - id: уникальный идентификатор узла
   - type: тип узла (Function, File, Concept и т.д.)
   - label: человекочитаемая метка
   - data: (опционально) структурированные данные
   ```

2. **mcp_memory_bank_update_node**
   ```
   Параметры:
   - project_name: имя проекта
   - id: идентификатор узла для обновления
   - newLabel: (опционально) новая метка для узла
   - data_to_merge: (опционально) данные для объединения с существующими
   ```

3. **mcp_memory_bank_add_edge**
   ```
   Параметры:
   - project_name: имя проекта
   - sourceId: идентификатор исходного узла
   - targetId: идентификатор целевого узла
   - relationshipType: тип отношения (CALLS, IMPLEMENTS и т.д.)
   ```

### Удаление

1. **mcp_memory_bank_delete_node**
   ```
   Параметры:
   - project_name: имя проекта
   - id: идентификатор узла для удаления
   ```

2. **mcp_memory_bank_delete_edge**
   ```
   Параметры:
   - project_name: имя проекта
   - sourceId: идентификатор исходного узла
   - targetId: идентификатор целевого узла
   - relationshipType: тип отношения для удаления
   ```

### Запросы

1. **mcp_memory_bank_get_node**
   ```
   Параметры:
   - project_name: имя проекта
   - id: идентификатор узла для получения
   ```

2. **mcp_memory_bank_get_all_nodes**
   ```
   Параметры:
   - project_name: имя проекта
   ```

3. **mcp_memory_bank_get_all_edges**
   ```
   Параметры:
   - project_name: имя проекта
   ```

4. **mcp_memory_bank_query_graph**
   ```
   Параметры:
   - project_name: имя проекта
   - query: объект запроса с фильтрами или параметрами соседей
     - filters: массив фильтров по атрибутам узлов
     - neighborsOf: ID узла для поиска соседей
     - relationshipType: фильтр соседей по типу отношения
     - direction: направление соседей (in, out, both)
   ```

## Примеры использования в режимах RIPER

### В режиме RESEARCH

```
[MODE: RESEARCH]

НАБЛЮДЕНИЯ:
* Мне нужно понять, какие компоненты зависят от модуля аутентификации

ДЕЙСТВИЯ:
1. Использую mcp_memory_bank_get_node для поиска узла аутентификации
2. Использую mcp_memory_bank_query_graph для поиска всех узлов, связанных с узлом аутентификации
3. Анализирую результаты для понимания зависимостей
```

### В режиме PLAN

```
[MODE: PLAN]

ЦЕЛЬ: Обновить модель данных пользователя и все зависимые компоненты

СПЕЦИФИКАЦИИ:
1. Обновить модель данных пользователя
2. Идентифицировать все компоненты, зависящие от модели пользователя, используя граф знаний
3. Обновить все зависимые компоненты

ПЛАН РЕАЛИЗАЦИИ:
1. Использовать mcp_memory_bank_query_graph для поиска всех компонентов, зависящих от модели пользователя
2. Обновить модель пользователя
3. Обновить каждый зависимый компонент
4. Обновить граф знаний, чтобы отразить изменения
```

### В режиме EXECUTE

```
[MODE: EXECUTE]

ВЫПОЛНЯЮ УТВЕРЖДЕННЫЙ ПЛАН:

ДЕЙСТВИЕ 1/4: Использую mcp_memory_bank_query_graph для поиска зависимых компонентов
СТАТУС: Выполнено

ДЕЙСТВИЕ 2/4: Обновляю модель пользователя
СТАТУС: Выполнено

ДЕЙСТВИЕ 3/4: Обновляю зависимые компоненты
СТАТУС: Выполнено

ДЕЙСТВИЕ 4/4: Обновляю граф знаний с помощью mcp_memory_bank_update_node
СТАТУС: Выполнено
```

## Рекомендации по моделированию

### Типы узлов

- **File**: Представляет физический файл в проекте
- **Function**: Представляет функцию или метод
- **Class**: Представляет класс или структуру данных
- **Component**: Представляет логический компонент системы
- **Concept**: Представляет абстрактную концепцию или паттерн
- **Requirement**: Представляет функциональное или нефункциональное требование

### Типы отношений

- **CONTAINS**: Указывает, что один элемент содержит другой (файл содержит функцию)
- **CALLS**: Указывает, что функция вызывает другую функцию
- **IMPLEMENTS**: Указывает, что компонент реализует концепцию или требование
- **DEPENDS_ON**: Указывает зависимость между компонентами
- **EXTENDS**: Указывает отношение наследования
- **RELATES_TO**: Общее отношение, указывающее на связь между элементами

## Интеграция с Банком Памяти

Граф знаний хранится в файле `graph.json` в директории проекта и автоматически обновляется при использовании инструментов графа. Этот файл является частью Банка Памяти и должен рассматриваться как ключевой ресурс для понимания структуры и взаимосвязей в проекте.

При обновлении Банка Памяти рекомендуется также обновлять граф знаний, чтобы он отражал текущее состояние проекта. Это особенно важно при значительных изменениях в архитектуре или функциональности.

## Заключение

Графовая структура знаний предоставляет мощный механизм для моделирования и запроса сложных взаимосвязей в проекте. Используя этот инструмент в сочетании с режимами RIPER и Банком Памяти, вы можете значительно улучшить понимание проекта и эффективность работы с ним.